<div class="flex justify-center mt-20 pb-36 md:ml-48 lg:ml-24 animate-fadeIn overflow-x-hidden">
  <div class="mx-auto pb-32 min-w-[330px] max-w-[330px] md:min-w-[780px] md:max-w-[780px]">
    <div class="bg-gray-100 rounded-lg">
      <div class="w-full mx-auto px-4">
        <!--通常サイズ-->
        <div class="grid grid-cols-3">
          <div class="mx-auto h-[180px] mt-4 md:mt-24 -ml-6 md:ml-auto">
            <div class="flex justify-center pt-6">
              <%= image_tag @profile.image.present? ? @profile.image : 'defaultUser.jpg', class: 'object-cover rounded-full size-20 md:size-40', width: 50, height: 50 %>
            </div>
            <div class="flex items-center justify-center font-normal md:mt-2">
              <!--フォローボタン-->
              <% if current_user != @user %>
              <div class="flex justify-center w-28 md:w-full mt-4 md:-ml-10">
                <%= render 'relationships/follow_button' %>
              </div>
              <% else %>
                <button id="openProfileModal" class="border border-gray-500 w-24 md:w-auto px-auto md:px-2 py-1 md:py-2 mt-4 ml-4 md:ml-8 text-xs rounded-full">プロフィールの編集</button>
              <% end %>
              <!--メッセージ-->
              <% if current_user.id != @user.id %>
                <% if @is_room %>
                  <!--すでにあるチャットルーム取得し表示-->
                  <%= link_to user_room_path(@user, @room_id), class: 'border border-black mt-4 ml-auto md:ml-4 p-1 rounded-full' do %>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" />
                    </svg>
                  <% end %>
                <% else %>
                  <!--チャットルーム新規作成-->
                  <%= form_with model: @room, url: user_rooms_path(@user, @room), method: :post, local: true do |f| %>
                    <%= fields_for @entry do |e| %>
                      <%= e.hidden_field :user_id, value: @user.id %>
                      <%= f.button type: 'submit', class: 'border border-black mt-4 md:ml-4 p-1 rounded-full' do %>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" />
                        </svg>
                      <% end %>
                    <% end %>
                  <% end %>
                <% end %>
              <% else %>
                <div class="mt-4 ml-2 md:ml-4 p-1">&nbsp;</div>
              <% end %>
            </div>
          </div>      
          <div class="w-[480px] mt-8 ml-0 md:ml-2">
            <div class="block md:flex items-center">
              <div class="pt-4 md:pt-8 pl-1 md:pl-2 text-2xl md:text-4xl font-semibold min-w-[200px] max-w-[200px]">
                <%= @user.name %>
              </div>
              <div class="flex items-center">
                <div class="text-sm md:text-base mt-1 md:mt-12 ml-">
                  <% if @user.follower_users.present? %>
                    <div class="cursor-pointer">
                      <%= link_to followers_user_path(@user) do %>
                        フォロワー <%= @user.follower_users.count %>人
                      <% end %>
                    </div>
                  <% else %>
                    フォロワー
                  <% end %>
                </div>
                <div class="text-sm md:text-base mt-1 md:mt-12 ml-2 md:ml-10">
                  <% if @user.followee_users.present? %>
                    <div class="cursor-pointer">
                      <%= link_to follows_user_path(@user) do %>
                        フォロー中 : <%= @user.followee_users.count %>人
                      <% end %>
                    </div>
                  <% else %>
                  フォロー
                  <% end %>
                </div>
              </div>
            </div>
            <!--通常サイズ プロフ一覧-->
            <div class="hidden md:block">
              <div class="grid grid-cols-3 pt-6 h-20">
                <div class="relative z-0 w-full mb-3 group">
                  <div class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-500/70">
                    楽器 : <%= @profile.instrument.present? ? @profile.instrument : '' %>
                  </div>
                </div>
                <div class="relative z-0 w-[320px] mb-3 group">
                  <div class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-500/70">
                    好きな音楽ジャンル : <%= @profile.favorite_music.present? ? @profile.favorite_music : '' %>
                  </div>
                </div>
              </div>
              <div class="relative z-0 w-full mb-3 group">               
                <div class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-500/70">
                  お気に入りアーティスト : <%= @profile.favorite_artist.present? ? @profile.favorite_artist : '' %>
                </div>
              </div>
              <div class="relative z-0 w-full mb-3 group">
                <div class="block h-24 py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-500/70" %>
                  自己紹介：<%= @profile.introduction.present? ? @profile.introduction : '' %>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!--SMサイズ プロフ一覧-->
        <div class="block md:hidden">
          <div class="relative z-0 w-full mb-3 group">
            <div class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-500/70">
              楽器 : <%= @profile.instrument.present? ? @profile.instrument : '' %>
            </div>
          </div> 
          <div class="relative z-0 w-full mb-3 group">
              <div class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-500/70">
                好きな音楽ジャンル : <%= @profile.favorite_music.present? ? @profile.favorite_music : '' %>
              </div>
            </div>
          <div class="relative z-0 w-full mb-3 group">               
            <div class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-500/70">
              お気に入りアーティスト : <%= @profile.favorite_artist.present? ? @profile.favorite_artist : '' %>
            </div>
          </div>
          <div class="relative z-0 w-full mb-3 group">
            <div class="block h-24 py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-500/70" %>
              自己紹介：<%= @profile.introduction.present? ? @profile.introduction : '' %>
            </div>
          </div>
        </div>
        
        <div class="w-full mt-8 md:ml-20 text-gray-900 font-semibold">
          <% if @user.posts.present? %>
            投稿一覧 <%= @user.posts.count %>件
          <% else %>
            投稿一覧 0件
          <% end %>
        </div>
        <div class="grid grid-cols-3 gap-1 mt-2 mx-auto md:mx-4 pb-8 overflow-y-auto overflow-x-none">  
          <% @users.each do |user| %>
            <%= link_to post_path(user) do %>
              <%= image_tag user.images.first, class: "object-cover h-24 md:h-52 w-28 md:w-64", size: "80x80" %> 
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="profileModal" class="fixed inset-0 justify-center bg-black/80 backdrop-blur-sm z-50 custom-scrollbar overflow-auto hidden">
  <button id="closeProfileModal" class="w-screen">閉じる</button>
  <div id="modalContent">
    <%= render 'profiles/edit', user: @user %>
  </div>
</div>
